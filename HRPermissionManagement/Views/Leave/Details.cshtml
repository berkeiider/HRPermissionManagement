@model HRPermissionManagement.Models.LeaveRequest
@using HRPermissionManagement.Models

@{
    ViewData["Title"] = "Talep Detayı";
}

<div class="max-w-5xl mx-auto mt-8">
    <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
        <div class="px-6 py-4 border-b border-slate-100 bg-slate-50 flex items-center justify-between">
            <h3 class="text-lg font-bold text-slate-800 flex items-center">
                <i class="fas fa-file-invoice mr-2 text-brand-600"></i>
                İzin Talebi Bilgileri
            </h3>
            <button type="button"
                class="text-slate-500 hover:text-slate-700 transition-colors hidden md:flex items-center text-sm font-medium"
                onclick="window.print();" title="Yazdır">
                <i class="fas fa-print mr-2"></i> Yazdır
            </button>
        </div>

        <div class="p-8">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <!-- Personel Bilgileri -->
                <div class="bg-blue-50 bg-opacity-50 p-6 rounded-xl border border-blue-100 h-full">
                    <h5 class="text-lg font-bold text-blue-900 mb-6 flex items-center">
                        <i class="fas fa-user-circle mr-2 opacity-75"></i> Personel Bilgileri
                    </h5>
                    <dl class="space-y-4">
                        <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                            <dt class="text-sm font-semibold text-blue-800">Ad Soyad:</dt>
                            <dd class="text-sm text-blue-900 col-span-2 sm:col-span-2">@Model.Employee?.Name
                                @Model.Employee?.Surname</dd>
                        </div>
                        <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                            <dt class="text-sm font-semibold text-blue-800">Departman:</dt>
                            <dd class="text-sm text-blue-900 col-span-2 sm:col-span-2">@Model.Employee?.Department?.Name
                            </dd>
                        </div>
                        <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                            <dt class="text-sm font-semibold text-blue-800">E-Posta:</dt>
                            <dd class="text-sm text-blue-900 col-span-2 sm:col-span-2">@Model.Employee?.Email</dd>
                        </div>
                    </dl>
                </div>

                <!-- İzin Detayları -->
                <div class="bg-orange-50 bg-opacity-50 p-6 rounded-xl border border-orange-100 h-full">
                    <h5 class="text-lg font-bold text-orange-900 mb-6 flex items-center">
                        <i class="fas fa-info-circle mr-2 opacity-75"></i> İzin Detayları
                    </h5>
                    <dl class="space-y-4">
                        <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                            <dt class="text-sm font-semibold text-orange-800">İzin Türü:</dt>
                            <dd class="text-sm text-orange-900 col-span-2 sm:col-span-2">
                                <span
                                    class="px-2 py-1 bg-white border border-orange-200 rounded text-xs font-semibold text-orange-800 shadow-sm">
                                    @Model.LeaveType?.Name
                                </span>
                            </dd>
                        </div>
                        <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                            <dt class="text-sm font-semibold text-orange-800">Tarih Aralığı:</dt>
                            <dd class="text-sm text-orange-900 col-span-2 sm:col-span-2 font-medium">
                                @if (Model.LeaveType != null && Model.LeaveType.IsHourly && Model.StartHour.HasValue &&
                                Model.EndHour.HasValue)
                                {
                                    @Model.StartDate.ToShortDateString() <span class="text-slate-500 mx-1">|</span>
                                    @Model.StartHour.Value.ToString(@"hh\:mm") <span class="text-slate-400">-</span>
                                    @Model.EndHour.Value.ToString(@"hh\:mm")
                                }
                                else
                                {
                                    @Model.StartDate.ToShortDateString() <span class="text-slate-400">-</span>
                                    @Model.EndDate.ToShortDateString()
                                }
                            </dd>
                        </div>
                        <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                            <dt class="text-sm font-semibold text-orange-800">Toplam Süre:</dt>
                            <dd class="text-sm text-orange-900 col-span-2 sm:col-span-2 font-bold">
                                @if (Model.LeaveType != null && Model.LeaveType.IsHourly)
                                {
                                        <span>@((Model.NumberOfDays * 9).ToString("0.##")) Saat</span>
                                }
                                else
                                {
                                        <span>@Model.NumberOfDays.ToString("0.##") Gün</span>
                                }
                            </dd>
                        </div>
                        <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                            <dt class="text-sm font-semibold text-orange-800">Durum:</dt>
                            <dd class="text-sm col-span-2 sm:col-span-2">
                                @if (Model.Status == LeaveStatus.Onaylandi)
                                {
                                        <span
                                            class="inline-flex px-3 py-1 bg-green-100 text-green-800 border border-green-200 rounded-full text-xs font-bold">ONAYLANDI</span>
                                }
                                else if (Model.Status == LeaveStatus.Reddedildi)
                                {
                                        <span
                                            class="inline-flex px-3 py-1 bg-red-100 text-red-800 border border-red-200 rounded-full text-xs font-bold">REDDEDİLDİ</span>
                                }
                                else if (Model.Status == LeaveStatus.YoneticiOnayladi)
                                {
                                        <span
                                            class="inline-flex px-3 py-1 bg-blue-100 text-blue-800 border border-blue-200 rounded-full text-xs font-bold">YÖNETİCİ
                                            ONAYLADI (İK Bekleniyor)</span>
                                }
                                else
                                {
                                        <span
                                            class="inline-flex px-3 py-1 bg-yellow-100 text-yellow-800 border border-yellow-200 rounded-full text-xs font-bold">BEKLİYOR</span>
                                }
                            </dd>
                        </div>
                    </dl>
                </div>
            </div>

            <div class="mt-8">
                <h5 class="text-sm font-bold text-slate-700 mb-3 flex items-center uppercase tracking-wide">
                    <i class="fas fa-comment-dots mr-2 text-slate-400"></i> Açıklama / Notlar
                </h5>
                <div class="p-6 border border-slate-200 rounded-lg bg-slate-50 text-slate-600 text-sm leading-relaxed">
                    @if (!string.IsNullOrEmpty(Model?.Description))
                    {
                        @Model.Description
                    }
                    else
                    {
                            <span class="text-slate-400 italic">Herhangi bir açıklama girilmemiş.</span>
                    }
                </div>
            </div>
        </div>

        <div class="bg-gray-50 px-6 py-4 flex items-center justify-between border-t border-gray-100 no-print">
            <a href="/Leave/Index"
                class="text-slate-500 hover:text-slate-800 font-medium text-sm flex items-center transition-colors">
                <i class="fas fa-arrow-left mr-2"></i> Listeye Dön
            </a>

            @{
                bool showActions = false;
                if (User.IsInRole("Admin") && (Model.Status == LeaveStatus.Bekliyor || Model.Status ==
                LeaveStatus.YoneticiOnayladi))
                {
                    showActions = true;
                }
                else if (User.HasClaim(c => c.Type == "IsManager") && Model.Status == LeaveStatus.Bekliyor)
                {
                    showActions = true;
                }
            }

            @if (showActions)
            {
                    <div class="flex space-x-3">
                        <a href="/Leave/Reject/@Model.Id"
                            class="inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition-colors"
                            onclick="return confirm('Bu talebi reddetmek istediğinize emin misiniz?');">
                            <i class="fas fa-times mr-2"></i> Reddet
                        </a>
                        <a href="/Leave/Approve/@Model.Id"
                            class="inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-colors">
                            <i class="fas fa-check mr-2"></i> Onayla
                        </a>
                    </div>
            }
        </div>
    </div>
</div>

<style media="print">
    .no-print {
        display: none !important;
    }

    body {
        background-color: #fff !important;
    }

    .shadow-sm,
    .shadow-md,
    .shadow-lg {
        box-shadow: none !important;
    }

    .border {
        border: 1px solid #ddd !important;
    }
</style>
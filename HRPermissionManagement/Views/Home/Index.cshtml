@model HRPermissionManagement.Models.DashboardViewModel

@{
    ViewData["Title"] = "Dashboard";
}

<div class="row pt-3 mb-3">
    <div class="col-12">
        <div class="alert alert-light p-3 d-flex align-items-center">
            <i class="fas fa-info-circle fa-lg text-primary mr-3"></i>
            <div>
                <h5 class="mb-0 font-weight-bold">Hoşgeldiniz, @User.Identity?.Name!</h5>
                <small class="text-muted">HR Yönetim paneli güncel durum özetiniz.</small>
            </div>
        </div>
    </div>
</div>

<div class="row mb-3">

    <div class="col-lg-4 col-md-6">
        <div class="small-box bg-success">
            <div class="inner">
                <h3>@Model.RemainingLeaveRight <sup style="font-size: 16px">Gün</sup></h3>
                <p>Kalan İzin Hakkı</p>
            </div>
            <div class="icon">
                <i class="fas fa-umbrella-beach"></i>
            </div>
            <a href="/Leave/MyLeaves" class="small-box-footer">Detayları Gör <i class="fas fa-arrow-right ml-2"></i></a>
        </div>
    </div>

    <div class="col-lg-4 col-md-6">
        <div class="small-box bg-warning">
            <div class="inner">
                <h3>@Model.PendingRequestsCount</h3>
                <p>Bekleyen Talep</p>
            </div>
            <div class="icon">
                <i class="far fa-clock"></i>
            </div>
            <a href="/Leave/Index" class="small-box-footer">İncele <i class="fas fa-arrow-right ml-1"></i></a>
        </div>
    </div>

    @if (User.IsInRole("Admin"))
    {
        <div class="col-lg-4 col-md-12">
            <div class="small-box bg-danger">
                <div class="inner">
                    <h3>@Model.TotalEmployeeCount</h3>
                    <p>Toplam Personel</p>
                </div>
                <div class="icon">
                    <i class="fas fa-users-cog"></i>
                </div>
                <a href="/Employee/Index" class="small-box-footer">Yönet <i class="fas fa-arrow-right ml-1"></i></a>
            </div>
        </div>
    }

</div>

<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header border-0">
                <h3 class="card-title">
                    <i class="fas fa-chart-pie mr-2 text-primary"></i>
                    Personel Dağılımı
                </h3>
            </div>
            <div class="card-body pt-0 pb-2">
                <div class="position-relative">
                    <canvas id="donutChart" style="min-height: 260px; height: 260px; max-height: 260px; max-width: 100%;"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        var deptNames = @Html.Raw(Json.Serialize(ViewBag.DeptNames ?? new List<string>()));
        var deptCounts = @Html.Raw(Json.Serialize(ViewBag.DeptCounts ?? new List<int>()));

        if(deptNames && deptNames.length > 0) {
            var donutChartCanvas = $('#donutChart').get(0).getContext('2d')

            var donutData = {
                labels: deptNames,
                datasets: [{
                    data: deptCounts,
                    backgroundColor : ['#3b82f6', '#10b981', '#f59e0b', '#6366f1', '#ec4899', '#8b5cf6'],
                    borderWidth: 2,
                    borderColor: '#fff',
                    hoverBorderColor: '#e2e8f0'
                }]
            }

            var donutOptions = {
                maintainAspectRatio : false,
                responsive : true,
                layout: {
                    padding: { top: 0, bottom: 0 }
                },
                plugins: {
                    legend: {
                        display: true,
                        position: 'right',
                        labels: {
                            font: { size: 12, family: "'Inter', sans-serif" }, // Font küçüldü
                            color: '#64748b',
                            padding: 15,
                            usePointStyle: true,
                            boxWidth: 8
                        }
                    },
                    tooltip: {
                        backgroundColor: 'rgba(30, 41, 59, 0.9)',
                        padding: 10,
                        cornerRadius: 6,
                        displayColors: false,
                        bodyFont: { size: 13, family: "'Inter', sans-serif" }
                    }
                },
                cutout: '70%', // Halka inceldi
                animation: { animateScale: true, animateRotate: true }
            }

            new Chart(donutChartCanvas, {
                type: 'doughnut',
                data: donutData,
                options: donutOptions
            });
        }
    });
</script>